"use strict";(self.webpackChunkGestorIncidentesFront=self.webpackChunkGestorIncidentesFront||[]).push([[439],{439:(Te,C,d)=>{d.r(C),d.d(C,{IncidentesModule:()=>be});var h=d(6814),c=d(95),x=d(6208),S=d(2898),T=d(360),e=d(4946),Z=d(4567),N=d(3519),f=d.n(N),_=d(9862),q=d(553),b=d(6306),v=d(2096);let U=(()=>{class n{constructor(){this.baseUrl=q.N.baseUrl,this.http=(0,e.f3M)(_.eN),this.ApiUrl="api/incidentes",this.ApiBusquedaUrl="api/buscar"}getIncidentes(i={desde:0,limite:5}){return this.http.get(`${this.baseUrl}/${this.ApiUrl}/?desde=${i.desde}&limite=${i.limite}`).pipe((0,b.K)(o=>(0,v.of)(o.error.msg)))}getIncidentesPorUsuario(i,t,o,a,r,u={desde:0,limite:5}){const I=`${this.baseUrl}/${this.ApiBusquedaUrl}/incidentesUsuario/${i}?tipoIncidente=${t}&estadoIncidente=${o}&idTecnico=${a}&estado=${r}&desde=${u.desde}&limite=${u.limite}`,g=(new _.WM).set("x-token",localStorage.getItem("x-token")||"");return this.http.get(I,{headers:g}).pipe((0,b.K)(l=>(0,v.of)(l.error.msg)))}getIncidentesPorUsuarioDocumento(i,t={desde:0,limite:5}){const o=`${this.baseUrl}/${this.ApiBusquedaUrl}/incidentesUsuarioDocumento/${i}/?desde=${t.desde}&limite=${t.limite}`,a=(new _.WM).set("x-token",localStorage.getItem("x-token")||"");return this.http.get(o,{headers:a}).pipe((0,b.K)(r=>(0,v.of)(r.error.msg)))}getIncidentesPorTipoEstado(i,t,o,a={desde:0,limite:5}){const r=`${this.baseUrl}/api/buscar/incidentesTipoEstado/${i}/?estadoIncidente=${t}&estado=${o}&desde=${a.desde}&limite=${a.limite}`,u=(new _.WM).set("x-token",localStorage.getItem("x-token")||"");return this.http.get(r,{headers:u}).pipe((0,b.K)(I=>(0,v.of)(I.error.msg)))}getIncidentePorId(i){return this.http.get(`${this.baseUrl}/${this.ApiUrl}/${i}`).pipe((0,b.K)(t=>(0,v.of)(t.error.msg)))}agregarIncidente(i){const t=`${this.baseUrl}/${this.ApiUrl}`,o=(new _.WM).set("x-token",localStorage.getItem("x-token")||"");return this.http.post(t,i,{headers:o})}actualizarIncidente(i){const t=`${this.baseUrl}/${this.ApiUrl}/${i.id}`,o=(new _.WM).set("x-token",localStorage.getItem("x-token")||"");return this.http.put(t,i,{headers:o})}borrarIncidente(i){const t=`${this.baseUrl}/${this.ApiUrl}/${i}`,o=(new _.WM).set("x-token",localStorage.getItem("x-token")||"");return this.http.delete(t,{headers:o})}}return n.\u0275fac=function(i){return new(i||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var E=d(7502),M=d(1818),O=d(3294),y=d(333),J=d(3179),R=d(5898);function k(n,s){1&n&&(e.TgZ(0,"h1",35),e._uU(1," Editar Incidente "),e.qZA())}function D(n,s){1&n&&(e.TgZ(0,"h1",35),e._uU(1," Registrar Incidente "),e.qZA())}function L(n,s){1&n&&(e.TgZ(0,"div",36)(1,"div",11),e._UZ(2,"input",37),e.TgZ(3,"label",27),e._uU(4,"Id:"),e.qZA()()())}function Q(n,s){if(1&n&&(e.TgZ(0,"option",38),e._uU(1),e.qZA()),2&n){const i=s.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.tinc_nombre," ")}}function $(n,s){if(1&n&&(e.TgZ(0,"option",38),e._uU(1),e.qZA()),2&n){const i=s.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.est_nombre," ")}}function P(n,s){if(1&n&&(e.TgZ(0,"div",19)(1,"div",20)(2,"select",39),e.YNc(3,$,2,2,"option",23),e.qZA(),e.TgZ(4,"label",40),e._uU(5,"Estado Incidente:"),e.qZA()()()),2&n){const i=e.oxw();e.xp6(3),e.Q6J("ngForOf",i.EstadoIncidentes)}}function w(n,s){if(1&n&&(e.TgZ(0,"option",38),e._uU(1),e.qZA()),2&n){const i=s.$implicit;e.Q6J("value",i.id),e.xp6(1),e.hij(" ",i.nombre," ")}}function B(n,s){if(1&n&&(e.TgZ(0,"div",19)(1,"div",20)(2,"select",41)(3,"option",22),e._uU(4,"Seleccionar opci\xf3n"),e.qZA(),e.YNc(5,w,2,2,"option",23),e.qZA(),e.TgZ(6,"label",42),e._uU(7,"Asignar Tecnico:"),e.qZA()()()),2&n){const i=e.oxw();e.xp6(5),e.Q6J("ngForOf",i.UsuariosTecnicos)}}function Y(n,s){1&n&&(e.TgZ(0,"span"),e._uU(1,"Actualizar"),e.qZA())}function F(n,s){1&n&&(e.TgZ(0,"span"),e._uU(1,"Registrar"),e.qZA())}let j=(()=>{class n{constructor(){this.fb=(0,e.f3M)(c.qu),this.authService=(0,e.f3M)(Z.e),this.tipoIncidentesService=(0,e.f3M)(O.O),this.estadoIncidentesService=(0,e.f3M)(J.s),this.usuariosService=(0,e.f3M)(R.J),this.incidentesService=(0,e.f3M)(U),this.validatorService=(0,e.f3M)(y.S),this.TipoIncidentes=[],this.EstadoIncidentes=[],this.UsuariosTecnicos=[],this.closeModal=new e.vpe,this.OnIncidente=!1,this.miFormulario=this.fb.group({id:[0],nombre:["",[c.kI.required,c.kI.minLength(6)]],descripcion:["",[c.kI.required,c.kI.minLength(6)]],estado:[!0,[c.kI.required]],estadoIncidenteId:[1,[c.kI.required,this.validatorService.cantBeZero]],tipoIncidenteId:[null,[c.kI.required,this.validatorService.cantBeZero]],usuarioId:[null,[c.kI.required,this.validatorService.cantBeZero]],usuarioRevisionId:[null,[c.kI.required,this.validatorService.cantBeZero]]})}ngOnInit(){this.obtenerTipoIncidentes(),this.obtenerEstadoIncidentes(),this.usuarioRegistro=this.authService.usuarioLogueado(),"ADMIN_ROLE"===this.authService.role()?(this.esAdmin=!0,this.obtenerUsuariosTecnicos()):(this.esAdmin=!1,this.miFormulario.setValue({id:0,nombre:"",descripcion:"",estado:!0,estadoIncidenteId:1,tipoIncidenteId:0,usuarioId:this.usuarioRegistro.id,usuarioRevisionId:this.usuarioRegistro.id}))}ngOnChanges(i){if(void 0!==this.IncidenteInput){this.OnIncidente=!0;let m,{id:t,inc_nombre:o,inc_descripcion:a,inc_estado:r,inc_usuarioId:u,inc_tipoIncidenteId:I,inc_estadoIncidenteId:g,inc_usuarioRevisionId:l}=this.IncidenteInput;if(this.miFormulario.setValue({id:t,nombre:o,descripcion:a,estado:r,tipoIncidenteId:I,estadoIncidenteId:g,usuarioId:u,usuarioRevisionId:l}),"MONGO"===this.BDIncidente){const{idMYSQL:p}=this.IncidenteInput;t=p}this.UsuariosTecnicos.forEach(p=>{l==p.id&&(m=p.id)}),m=0==m?0:l,console.log("Usuarios Tecnicos",this.UsuariosTecnicos),this.miFormulario.setValue({id:t,nombre:o,descripcion:a,estado:r,tipoIncidenteId:I,estadoIncidenteId:g,usuarioId:u,usuarioRevisionId:m})}else this.OnIncidente=!1}obtenerTipoIncidentes(){this.tipoIncidentesService.getTipoIncidentes().subscribe(({tipoIncidentesMy:i,totalMYSQL:t,tipoIncidentesMo:a})=>{this.TipoIncidentes=0==t?a:i})}obtenerEstadoIncidentes(){this.estadoIncidentesService.getEstadoIncidentes().subscribe(({estadoIncidentesMy:i,totalMYSQL:t,estadoIncidentesMo:a})=>{this.EstadoIncidentes=0==t?a:i})}obtenerUsuariosTecnicos(){this.usuariosService.obtenerUsuariosPorRole(3,!0).subscribe(({usuariosMy:i,totalMYSQL:t,usuariosMo:o})=>{this.UsuariosTecnicos=0==t?o:i})}onSubmit(){let{nombre:i,descripcion:t,estadoIncidenteId:o,estado:a,tipoIncidenteId:r,usuarioId:u,usuarioRevisionId:I}=this.miFormulario.value,g=+I;if(this.miFormulario.invalid)this.miFormulario.markAllAsTouched();else if(void 0!==this.IncidenteInput)if(!0===this.esAdmin&&g!==u){let l;l={id:this.IncidenteInput.id,inc_nombre:i,inc_descripcion:t,inc_estadoIncidenteId:o,inc_tipoIncidenteId:r,inc_usuarioId:u,inc_usuarioRevisionId:g,inc_usuarioAdmin:this.usuarioRegistro.id},console.log("incidente a ACtualizar",l),this.incidentesService.actualizarIncidente(l).subscribe(m=>{f().fire("Incidente Actualizado",m.msg,"success").then(p=>{p.isConfirmed&&location.reload()},p=>{f().fire("Error",p.error.errors[0].msg,"error")})})}else{let l;l={id:this.IncidenteInput.id,inc_nombre:i,inc_descripcion:t,inc_estadoIncidenteId:o,inc_tipoIncidenteId:r,inc_usuarioId:u,inc_usuarioRevisionId:g},console.log("Incidente a Actualizar usuario",l),this.incidentesService.actualizarIncidente(l).subscribe(m=>{f().fire("Incidente Actualizado",m.msg,"success").then(p=>{p.isConfirmed&&location.reload()})},m=>{f().fire("Error",m.error.errors[0].msg,"error")})}else{let l={inc_nombre:i,inc_descripcion:t,inc_estadoIncidenteId:o,inc_estado:a,inc_tipoIncidenteId:r,inc_usuarioId:this.usuarioRegistro.id,inc_usuarioRevisionId:this.usuarioRegistro.id};console.log("Incidente a registrar",l),f().fire({title:"Terminos y Condiciones",html:'<div class="terms-content text-center" style="height: 200px; overflow: auto;" >  <h1>Acuerdo de Tratamiento de Datos Personales Sistema Gestor de Incidentes de la CORPORACI\xd3N AUTONOMA DE LA FRONTERA NOR-ORIENTAL-CORPONOR</h1>\n    <p>Este Acuerdo de Tratamiento de Datos Personales ("Acuerdo") establece los t\xe9rminos y condiciones bajo los cuales el Sistema Gestor de Incidentes (www.gestordeincidentescorponor.com) \n       recopila, almacena, utiliza y protege los datos personales de los usuarios de acuerdo con las disposiciones de la Ley colombiana de protecci\xf3n de datos personales y su reglamentaci\xf3n\n       aplicable. Al acceder y utilizar el Sitio web, usted ("el Usuario") acepta los t\xe9rminos y condiciones de este Acuerdo.</p>\n\n    <h2>Responsable del Tratamiento de Datos</h2>\n    <p>El responsable del tratamiento de los datos personales recopilados a trav\xe9s del Sitio web es Jean Eduardo Garc\xeda, identificado con CC 1.078.325.968.</p>\n\n    <h2>Datos Personales Recopilados</h2>\n    <p>El Sitio web recopilar\xe1 los siguientes datos personales del Usuario:</p>\n    <ul>\n        <li>Nombre completo</li>\n        <li>Direcci\xf3n de correo electr\xf3nico</li>\n        <li>Informaci\xf3n de contacto</li>\n        <li>T\xe9lefono</li>\n        <li>Otros datos personales proporcionados voluntariamente por el Usuario</li>\n    </ul>\n\n    <h2>Finalidades del Tratamiento</h2>\n    <p>Los datos personales recopilados ser\xe1n utilizados para las siguientes finalidades:</p>\n    <ul>\n        <li>Proveer y personalizar los servicios ofrecidos en el Sitio web</li>\n        <li>Enviar informaci\xf3n y comunicaciones relacionadas con los servicios del Sitio web</li>\n        <li>Realizar an\xe1lisis y estudios estad\xedsticos sobre el uso del Sitio web</li>\n        <li>Cumplir con las obligaciones legales y regulatorias</li>\n    </ul>\n\n    <h2>Consentimiento</h2>\n    <p>Al proporcionar sus datos personales a trav\xe9s del Sitio web, el Usuario otorga su consentimiento expl\xedcito para que el Sitio web recopile, almacene, utilice y transfiera sus datos\n    personales de acuerdo con las finalidades establecidas en este Acuerdo.</p>\n\n    <h2>Transferencia de Datos</h2>\n    <p>El Sitio web podr\xe1 transferir los datos personales del Usuario a terceros, incluyendo proveedores de servicios y socios comerciales, siempre y cuando sea necesario para cumplir con \n    las finalidades establecidas en este Acuerdo. Estas transferencias se realizar\xe1n de acuerdo con las disposiciones legales aplicables.</p>\n\n    <h2>Seguridad de los Datos</h2>\n    <p>El Sitio web implementar\xe1 las medidas t\xe9cnicas y organizativas apropiadas para proteger los datos personales del Usuario contra p\xe9rdida, acceso no autorizado, divulgaci\xf3n, alteraci\xf3n\n    o destrucci\xf3n indebida.</p>\n\n    <h2>Derechos del Usuario</h2>\n    <p>El Usuario tiene derecho a acceder, rectificar, actualizar y suprimir susdatos personales, as\xed como a oponerse al tratamiento de los mismos. Para ejercer estos derechos, el Usuario \n    puede ponerse en contacto con el Sitio web a trav\xe9s de los canales de comunicaci\xf3n indicados en la secci\xf3n 9 de este Acuerdo.</p>\n\n    <h2>Vigencia y Modificaci\xf3n</h2>\n    <p>Este Acuerdo entra en vigencia a partir de la fecha de aceptaci\xf3n por parte del Usuario y se mantendr\xe1 en vigor hasta que sea modificado o terminado por cualquiera de las partes. \n    El Sitio web se reserva el derecho de modificar este Acuerdo en cualquier momento, notificando al Usuario de tales modificaciones.</p>\n\n    <h2>Contacto</h2>\n    <p>Para cualquier consulta, solicitud o reclamo relacionado con el tratamiento de datos personales, el Usuario puede ponerse en contacto con el Sitio web a trav\xe9s de \n    corponordigital@corponordigital.org</p>\n\n    <p>Al aceptar este Acuerdo, el Usuario reconoce haber le\xeddo, entendido y aceptado los t\xe9rminos y condiciones establecidos.</p></div><div class="terms-checkbox mt-2"><input type="checkbox" id="acceptTerms"> <label for="acceptTerms"> Acepto los terminos y condiciones.</label></div>',inputValue:0,showCloseButton:!0,showCancelButton:!0,focusConfirm:!1,confirmButtonText:"Continuar",confirmButtonColor:"#0d6efd",cancelButtonText:"Cancelar",cancelButtonColor:"#dc3545",preConfirm:()=>!!document.getElementById("acceptTerms").checked||(f().showValidationMessage("Por favor Acepte los terminios y condiciones."),!1)}).then(m=>{m.isConfirmed&&this.incidentesService.agregarIncidente(l).subscribe(p=>{f().fire(`Incidente Registrado ,Numero de Turno ${p.incidente.id}`,p.msg,"success").then(ve=>{ve.isConfirmed&&location.reload()})},p=>{f().fire("Error",p.error.errors[0].msg,"error")})})}}cerrarModal(){this.closeModal.emit(!1),this.IncidenteInput=void 0,this.miFormulario.reset()}}return n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-incidenteModal"]],inputs:{IncidenteInput:"IncidenteInput",BDIncidente:"BDIncidente",esAdmin:"esAdmin",esUsuarioNormal:"esUsuarioNormal"},outputs:{closeModal:"closeModal"},features:[e.TTD],decls:52,vars:13,consts:[["id","Modal","tabindex","-1","aria-labelledby","Modal","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],["class","modal-title fs-5 m-0","id","exampleModalLabel",4,"ngIf"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],["autocomplete","off",3,"formGroup","ngSubmit"],[1,"row","mb-3"],["class","col-3 col-sm-3 m-0 p-0",4,"ngIf"],[1,"col","m-0","p-0"],[1,"form-floating"],["type","text","id","usuarioNombre","required","",1,"form-control-plaintext",3,"value"],["for","usuarioNombre",1,"form-label"],["type","text","id","usuarioDependencia","required","",1,"form-control-plaintext",3,"value"],["for","usuarioDependencia",1,"form-label"],[1,"col-12","col-sm-6","m-0","p-0"],["type","text","id","usuarioCorreo","required","",1,"form-control-plaintext",3,"value"],["for","usuarioCorreo",1,"form-label"],[1,"col-12","col-sm"],[1,"mb-3","form-floating"],["id","tipoIncidenteId","formControlName","tipoIncidenteId","required","",1,"form-select"],["value","0"],[3,"value",4,"ngFor","ngForOf"],["for","tipoIncidenteId"],[1,"col-12"],["type","text","id","nombre","formControlName","nombre","required","",1,"form-control"],["for","nombre",1,"form-label"],["class","col-12 col-sm",4,"ngIf"],[1,"row","mb-3","p-0","p-0"],["id","descripcion","rows","3","formControlName","descripcion","required","",1,"form-control"],["for","descripcion",1,"form-label"],[1,"modal-footer"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[4,"ngIf"],["id","exampleModalLabel",1,"modal-title","fs-5","m-0"],[1,"col-3","col-sm-3","m-0","p-0"],["type","text","id","id","formControlName","id","required","",1,"form-control-plaintext"],[3,"value"],["id","estadoIncidenteId","formControlName","estadoIncidenteId","required","",1,"form-select"],["for","estadoIncidenteId"],["id","usuarioRevisionId","formControlName","usuarioRevisionId","required","",1,"form-select"],["for","usuarioRevisionId"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e.YNc(4,k,2,0,"h1",4),e.YNc(5,D,2,0,"h1",4),e.TgZ(6,"button",5),e.NdJ("click",function(){return t.cerrarModal()}),e.qZA()(),e.TgZ(7,"div",6)(8,"form",7),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e.TgZ(9,"div",8),e.YNc(10,L,5,0,"div",9),e.TgZ(11,"div",10)(12,"div",11),e._UZ(13,"input",12),e.TgZ(14,"label",13),e._uU(15," Usuario:"),e.qZA()()(),e.TgZ(16,"div",10)(17,"div",11),e._UZ(18,"input",14),e.TgZ(19,"label",15),e._uU(20," Dependencia "),e.qZA()()()(),e.TgZ(21,"div",8)(22,"div",16)(23,"div",11),e._UZ(24,"input",17),e.TgZ(25,"label",18),e._uU(26,"Correo del Usuario"),e.qZA()()()(),e.TgZ(27,"div",8)(28,"div",19)(29,"div",20)(30,"select",21)(31,"option",22),e._uU(32,"Seleccionar opci\xf3n"),e.qZA(),e.YNc(33,Q,2,2,"option",23),e.qZA(),e.TgZ(34,"label",24),e._uU(35,"Tipo Incidente:"),e.qZA()()(),e.TgZ(36,"div",25)(37,"div",20),e._UZ(38,"input",26),e.TgZ(39,"label",27),e._uU(40,"Nombre Incidente:"),e.qZA()()(),e.YNc(41,P,6,1,"div",28),e.YNc(42,B,8,1,"div",28),e.qZA(),e.TgZ(43,"div",29)(44,"div",11),e._UZ(45,"textarea",30),e.TgZ(46,"label",31),e._uU(47,"Descripcion:"),e.qZA()()()()(),e.TgZ(48,"div",32)(49,"button",33),e.NdJ("click",function(){return t.onSubmit()}),e.YNc(50,Y,2,0,"span",34),e.YNc(51,F,2,0,"span",34),e.qZA()()()()()),2&i&&(e.xp6(4),e.Q6J("ngIf",t.OnIncidente),e.xp6(1),e.Q6J("ngIf",!t.OnIncidente),e.xp6(3),e.Q6J("formGroup",t.miFormulario),e.xp6(2),e.Q6J("ngIf",t.OnIncidente),e.xp6(3),e.Q6J("value",t.usuarioRegistro.nombre),e.xp6(5),e.Q6J("value",t.usuarioRegistro.dependencia),e.xp6(6),e.Q6J("value",t.usuarioRegistro.correo),e.xp6(9),e.Q6J("ngForOf",t.TipoIncidentes),e.xp6(8),e.Q6J("ngIf",!t.esUsuarioNormal),e.xp6(1),e.Q6J("ngIf",t.esAdmin),e.xp6(7),e.Q6J("disabled",t.miFormulario.invalid),e.xp6(1),e.Q6J("ngIf",void 0!==t.IncidenteInput),e.xp6(1),e.Q6J("ngIf",void 0===t.IncidenteInput))},dependencies:[h.sg,h.O5,c._Y,c.YN,c.Kr,c.Fj,c.EJ,c.JJ,c.JL,c.Q7,c.sg,c.u]}),n})();function z(n,s){1&n&&e._UZ(0,"i",15)}function G(n,s){1&n&&e._UZ(0,"i",16)}function K(n,s){1&n&&e._UZ(0,"i",17)}function V(n,s){1&n&&e._UZ(0,"i",18)}function W(n,s){1&n&&e._UZ(0,"i",19)}function X(n,s){1&n&&e._UZ(0,"i",20)}const H=function(n){return{"background-color":n}};let ee=(()=>{class n{constructor(){this.incidentesService=(0,e.f3M)(U),this.authService=(0,e.f3M)(Z.e),this.incidentes=[],this.cantidad=0}ngOnInit(){if("ADMIN_ROLE"===this.authService.role())switch(this.EstadoIncidenteInput){case"Pendientes":this.incidentesService.getIncidentesPorTipoEstado(1,1,this.Estado).subscribe(({incidentesMy:i,incidentesMo:t,totalMYSQL:o,totalMongoDB:a})=>{i?(this.incidentes=i,this.cantidad=o):(this.incidentes=t,this.cantidad=a)});break;case"Resueltas":this.incidentesService.getIncidentesPorTipoEstado(1,2,this.Estado).subscribe(({incidentesMy:i,incidentesMo:t,totalMYSQL:o,totalMongoDB:a})=>{i?(this.incidentes=i,this.cantidad=o):(this.incidentes=t,this.cantidad=a)});break;case"Cerradas":this.incidentesService.getIncidentesPorTipoEstado(1,3,this.Estado).subscribe(({incidentesMy:i,incidentesMo:t,totalMYSQL:o,totalMongoDB:a})=>{i?(this.incidentes=i,this.cantidad=o):(this.incidentes=t,this.cantidad=a)})}else{let i=this.authService.usuarioLogueado();if("USER_ROLE"===i.role)switch(this.EstadoIncidenteInput){case"Pendientes":this.incidentesService.getIncidentesPorUsuario(i.id,1,1,0,this.Estado).subscribe(({incidentesMy:t,incidentesMo:o,totalMYSQL:a,totalMongoDB:r})=>{t?(this.incidentes=t,this.cantidad=a):(this.incidentes=o,this.cantidad=r)});break;case"Resueltas":this.incidentesService.getIncidentesPorUsuario(i.id,1,2,0,this.Estado).subscribe(({incidentesMy:t,incidentesMo:o,totalMYSQL:a,totalMongoDB:r})=>{t?(this.incidentes=t,this.cantidad=a):(this.incidentes=o,this.cantidad=r)});break;case"Cerradas":this.incidentesService.getIncidentesPorUsuario(i.id,1,3,0,this.Estado).subscribe(({incidentesMy:t,incidentesMo:o,totalMYSQL:a,totalMongoDB:r})=>{t?(this.incidentes=t,this.cantidad=a):(this.incidentes=o,this.cantidad=r)})}else if("TECNICO"===i.role)switch(this.EstadoIncidenteInput){case"Pendientes":this.incidentesService.getIncidentesPorUsuario(i.id,0,1,i.id,this.Estado).subscribe(({incidentesMy:t,incidentesMo:o,totalMYSQL:a,totalMongoDB:r})=>{t?(this.incidentes=t,this.cantidad=a):(this.incidentes=o,this.cantidad=r)});break;case"Resueltas":this.incidentesService.getIncidentesPorUsuario(i.id,0,2,i.id,this.Estado).subscribe(({incidentesMy:t,incidentesMo:o,totalMYSQL:a,totalMongoDB:r})=>{t?(this.incidentes=t,this.cantidad=a):(this.incidentes=o,this.cantidad=r)});break;case"Cerradas":this.incidentesService.getIncidentesPorUsuario(i.id,0,3,i.id,this.Estado).subscribe(({incidentesMy:t,incidentesMo:o,totalMYSQL:a,totalMongoDB:r})=>{t?(this.incidentes=t,this.cantidad=a):(this.incidentes=o,this.cantidad=r)})}}}}return n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["incidentes-card-info"]],inputs:{EstadoIncidenteInput:"EstadoIncidenteInput",Estado:"Estado",ColorTarjeta:"ColorTarjeta"},decls:18,vars:12,consts:[[1,"card","me-2",3,"ngStyle"],[1,"row","m-0","p-0","text-light","animate__animated","animate__fadeIn"],[1,"col-8","col-sm-9"],[1,"card-body","d-flex","justify-content-center","align-content-center","p-0","m-0"],[1,"col","text-start","p-0","m-0"],[1,"card-title","text-nowrap","d-none","d-sm-block"],[1,"card-title","d-block","d-sm-none"],[1,"card-text"],[1,"col-4","col-sm-3","d-flex","justify-content-center","align-items-center"],["class","d-none d-sm-block  fa fa-question fa-4x",4,"ngIf"],["class","d-block d-sm-none fa fa-question fa-2x",4,"ngIf"],["class","d-none d-sm-block  fa fa-check fa-4x",4,"ngIf"],["class","d-block d-sm-none fa fa-check fa-2x",4,"ngIf"],["class","d-none d-sm-block  fa fa-archive fa-4x",4,"ngIf"],["class","d-block d-sm-none fa fa-archive fa-2x",4,"ngIf"],[1,"d-none","d-sm-block","fa","fa-question","fa-4x"],[1,"d-block","d-sm-none","fa","fa-question","fa-2x"],[1,"d-none","d-sm-block","fa","fa-check","fa-4x"],[1,"d-block","d-sm-none","fa","fa-check","fa-2x"],[1,"d-none","d-sm-block","fa","fa-archive","fa-4x"],[1,"d-block","d-sm-none","fa","fa-archive","fa-2x"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h4",5),e._uU(6),e.qZA(),e.TgZ(7,"h6",6),e._uU(8),e.qZA(),e.TgZ(9,"p",7),e._uU(10),e.qZA()()()(),e.TgZ(11,"div",8),e.YNc(12,z,1,0,"i",9),e.YNc(13,G,1,0,"i",10),e.YNc(14,K,1,0,"i",11),e.YNc(15,V,1,0,"i",12),e.YNc(16,W,1,0,"i",13),e.YNc(17,X,1,0,"i",14),e.qZA()()()),2&i&&(e.Q6J("ngStyle",e.VKq(10,H,t.ColorTarjeta)),e.xp6(6),e.hij(" Incidentes ",t.EstadoIncidenteInput," "),e.xp6(2),e.hij(" Incidentes ",t.EstadoIncidenteInput," "),e.xp6(2),e.Oqu(t.cantidad),e.xp6(2),e.Q6J("ngIf","Pendientes"===t.EstadoIncidenteInput),e.xp6(1),e.Q6J("ngIf","Pendientes"===t.EstadoIncidenteInput),e.xp6(1),e.Q6J("ngIf","Resueltas"===t.EstadoIncidenteInput),e.xp6(1),e.Q6J("ngIf","Resueltas"===t.EstadoIncidenteInput),e.xp6(1),e.Q6J("ngIf","Cerradas"===t.EstadoIncidenteInput),e.xp6(1),e.Q6J("ngIf","Cerradas"===t.EstadoIncidenteInput))},dependencies:[h.O5,h.PC],styles:["i[_ngcontent-%COMP%]{color:#fff}"]}),n})(),ie=(()=>{class n{transform(i){const{inc_usuario:t,inc_usuarioRevision:o}=i;return t.correo===o.correo?"A la espera de Revision por parte de un Administrador":o.correo}}return n.\u0275fac=function(i){return new(i||n)},n.\u0275pipe=e.Yjl({name:"revisionAdmin",type:n,pure:!0}),n})();function te(n,s){if(1&n&&(e.TgZ(0,"div",20),e._UZ(1,"incidentes-card-info",21),e.qZA()),2&n){const i=s.$implicit;e.xp6(1),e.Q6J("EstadoIncidenteInput",i.estadoIncidente)("Estado",i.estado)("ColorTarjeta",i.color)}}function ne(n,s){1&n&&(e.TgZ(0,"h3"),e._uU(1,"Incidentes"),e.qZA())}function oe(n,s){1&n&&(e.TgZ(0,"h3"),e._uU(1,"Incidentes Asignados"),e.qZA())}function se(n,s){1&n&&(e.TgZ(0,"h3"),e._uU(1,"Incidentes Totales"),e.qZA())}function ae(n,s){1&n&&(e.TgZ(0,"button",22),e._UZ(1,"i",23),e.qZA())}function re(n,s){if(1&n){const i=e.EpF();e.TgZ(0,"app-searchbox",24),e.NdJ("numDocumento",function(o){e.CHM(i);const a=e.oxw();return e.KtG(a.onChangeDocumento(o))}),e.qZA()}}function de(n,s){1&n&&(e.TgZ(0,"th",14),e._uU(1,"Usuario"),e.qZA())}function ce(n,s){1&n&&(e.TgZ(0,"th",14),e._uU(1,"N.Documento"),e.qZA())}function le(n,s){1&n&&(e.TgZ(0,"th",14),e._uU(1,"Correo"),e.qZA())}function ue(n,s){1&n&&(e.TgZ(0,"th",14),e._uU(1,"Telefono"),e.qZA())}function pe(n,s){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const i=e.oxw().$implicit;e.xp6(1),e.Oqu(i.inc_usuario.nombre)}}function me(n,s){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const i=e.oxw().$implicit;e.xp6(1),e.Oqu(i.inc_usuario.numDocumento)}}function fe(n,s){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const i=e.oxw().$implicit;e.xp6(1),e.Oqu(i.inc_usuario.correo)}}function he(n,s){if(1&n&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&n){const i=e.oxw().$implicit;e.xp6(1),e.Oqu(i.inc_usuario.telefono)}}function Ie(n,s){if(1&n){const i=e.EpF();e.TgZ(0,"tr",13)(1,"th",25),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.ALo(5,"titlecase"),e.qZA(),e.TgZ(6,"td"),e._uU(7),e.qZA(),e.YNc(8,pe,2,1,"td",5),e.YNc(9,me,2,1,"td",5),e.YNc(10,fe,2,1,"td",5),e.YNc(11,he,2,1,"td",5),e.TgZ(12,"td"),e._uU(13),e.ALo(14,"revisionAdmin"),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.qZA(),e.TgZ(17,"td"),e._uU(18),e.qZA(),e.TgZ(19,"td"),e._uU(20),e.ALo(21,"date"),e.qZA(),e.TgZ(22,"td")(23,"div",26)(24,"button",27),e.NdJ("click",function(){const a=e.CHM(i).$implicit,r=e.oxw();return e.KtG(r.editarIncidente(a))}),e._UZ(25,"i",28),e._uU(26," Editar "),e.qZA(),e.TgZ(27,"button",29),e.NdJ("click",function(){const a=e.CHM(i).$implicit,r=e.oxw();return e.KtG(r.eliminarIncidente(a))}),e._UZ(28,"i",30),e._uU(29," Eliminar "),e.qZA()()()()}if(2&n){const i=s.$implicit,t=e.oxw();e.xp6(2),e.Oqu(i.id),e.xp6(2),e.Oqu(e.lcZ(5,11,i.inc_nombre)),e.xp6(3),e.Oqu(i.inc_descripcion),e.xp6(1),e.Q6J("ngIf",!t.esUsuarioNormal),e.xp6(1),e.Q6J("ngIf",!t.esUsuarioNormal),e.xp6(1),e.Q6J("ngIf",!t.esUsuarioNormal),e.xp6(1),e.Q6J("ngIf",!t.esUsuarioNormal),e.xp6(2),e.Oqu(e.lcZ(14,13,i)),e.xp6(3),e.Oqu(i.inc_tipoIncidente.tinc_nombre),e.xp6(2),e.Oqu(i.inc_estadoIncidente.est_nombre),e.xp6(2),e.Oqu(e.lcZ(21,15,i.createdAt))}}let A=(()=>{class n{constructor(){this.infoIncidentesCard=[{estadoIncidente:"Pendientes",estado:!0,color:"#AF6C6C"},{estadoIncidente:"Resueltas",estado:!0,color:"#339966"},{estadoIncidente:"Cerradas",estado:!1,color:"gray"}],this.incidentes=[],this.authService=(0,e.f3M)(Z.e),this.incidentesService=(0,e.f3M)(U),this.router=(0,e.f3M)(T.F0),this.BDIncidente="",this.modalOn=!1,this.esAdmin=!1,this.esUsuarioNormal=!1}ngOnInit(){"ADMIN_ROLE"===this.authService.role()?this.esAdmin=!0:"USER_ROLE"===this.authService.role()&&(this.esUsuarioNormal=!0),this.obtenerIncidentes()}obtenerIncidentes(i){if(!0===this.esAdmin&&this.incidentesService.getIncidentes(i).subscribe(({incidentesMy:t,totalMYSQL:o,incidentesMo:r})=>{0==o?(this.incidentes=r,this.BDIncidente="MONGO"):(this.incidentes=t,this.BDIncidente="MYSQL")}),!1===this.esAdmin){let t=this.authService.usuarioLogueado();"USER_ROLE"===t.role?this.incidentesService.getIncidentesPorUsuario(t.id,0,0,0,!0,i).subscribe(({incidentesMy:o,totalMYSQL:a,incidentesMo:u})=>{a>0?(this.incidentes=o,this.BDIncidente="MYSQL"):(this.incidentes=u,this.BDIncidente="MONGO")}):"TECNICO"===t.role&&this.incidentesService.getIncidentesPorUsuario(t.id,0,1,t.id,!0,i).subscribe(({incidentesMy:o,totalMYSQL:a,incidentesMo:u})=>{a>0?(this.incidentes=o,this.BDIncidente="MYSQL"):(this.incidentes=u,this.BDIncidente="MONGO")})}}editarIncidente(i){this.incidenteSeleccionado=i,this.modalOn=!0}eliminarIncidente(i){console.log("Clickeado editar",i.inc_descripcion),f().fire({title:"Seguro que desea eliminar el Incidente?",text:"No podra revertir esto.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, Eliminar incidente."}).then(t=>{t.isConfirmed&&this.incidentesService.borrarIncidente(i.id).subscribe(o=>{f().fire(`Incidente ${o.incidenteMy.inc_nombre} Eliminado!`,`${o.msg}`,"success").then(a=>{a.isConfirmed&&location.reload()})})})}onCloseModal(i){this.modalOn=i,this.incidenteSeleccionado=void 0}obtenerIncidentesUsuarioDocumento(i){if(""!==i)this.incidentesService.getIncidentesPorUsuarioDocumento(i).subscribe(({incidentesMy:t,incidentesMo:r})=>{if(t||r){if(t)return this.incidentes=[],this.incidentes=t,void(this.BDIncidente="MYSQL");r&&(this.incidentes=[],this.incidentes=r,this.BDIncidente="MONGO")}});else{if(this.incidentes.length>1)return;this.obtenerIncidentes()}}onChangeDocumento(i){this.obtenerIncidentesUsuarioDocumento(i)}onChangePage(i){this.obtenerIncidentes(i)}}return n.\u0275fac=function(i){return new(i||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-listado"]],decls:43,vars:16,consts:[[1,"container-fluid","p-0","m-0"],[1,"row","m-0","animate__animated","animate__fadeIn","d-flex","justify-content-center"],["class","col-3 me-2 pt-2 p-0",4,"ngFor","ngForOf"],[1,"row","d-flex","justify-content-around","m-0","p-0","animate__animated","animate__fadeIn"],[1,"col","p-2"],[4,"ngIf"],[1,"row"],[1,"col"],["type","button","class","btn btn-primary","data-bs-toggle","modal","data-bs-target","#Modal",4,"ngIf"],[3,"numDocumento",4,"ngIf"],[1,"col","d-flex","justify-content-end","p-2"],[1,"table-responsive"],[1,"table","table-bordered","table-hover","text-center","animate__animated","animate__fadeIn"],[1,"animate__animated","animate__fadeIn"],["scope","col"],["scope","col",4,"ngIf"],["class","animate__animated animate__fadeIn",4,"ngFor","ngForOf"],[1,"container-fluid","d-flex","justify-content-center"],[3,"items","cambioPagina"],[3,"IncidenteInput","BDIncidente","esAdmin","esUsuarioNormal","closeModal"],[1,"col-3","me-2","pt-2","p-0"],[3,"EstadoIncidenteInput","Estado","ColorTarjeta"],["type","button","data-bs-toggle","modal","data-bs-target","#Modal",1,"btn","btn-primary"],[1,"bi","bi-plus-lg"],[3,"numDocumento"],["scope","row"],[1,"d-flex"],["type","button","data-bs-toggle","modal","data-bs-target","#Modal",1,"btn","btn-sm","backgroundColor","text-light",3,"click"],["aria-hidden","true",1,"fa","fa-pencil"],["type","button",1,"btn","btn-sm","btn-danger",3,"click"],["aria-hidden","true",1,"fa","fa-trash-o"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,te,2,3,"div",2),e.qZA(),e.TgZ(3,"div",3)(4,"div",4),e.YNc(5,ne,2,0,"h3",5),e.YNc(6,oe,2,0,"h3",5),e.YNc(7,se,2,0,"h3",5),e.TgZ(8,"div",6)(9,"div",7),e.YNc(10,ae,2,0,"button",8),e.qZA(),e.TgZ(11,"div",7),e.YNc(12,re,1,0,"app-searchbox",9),e.qZA()()(),e._UZ(13,"div",10),e.qZA(),e.TgZ(14,"div",11)(15,"table",12)(16,"thead")(17,"tr",13)(18,"th",14),e._uU(19,"#"),e.qZA(),e.TgZ(20,"th",14),e._uU(21,"Nombre"),e.qZA(),e.TgZ(22,"th",14),e._uU(23,"Descripcion"),e.qZA(),e.YNc(24,de,2,0,"th",15),e.YNc(25,ce,2,0,"th",15),e.YNc(26,le,2,0,"th",15),e.YNc(27,ue,2,0,"th",15),e.TgZ(28,"th",14),e._uU(29,"Usuario Revision"),e.qZA(),e.TgZ(30,"th",14),e._uU(31,"Tipo"),e.qZA(),e.TgZ(32,"th",14),e._uU(33,"Estado"),e.qZA(),e.TgZ(34,"th",14),e._uU(35,"Fecha Creacion"),e.qZA(),e.TgZ(36,"th",14),e._uU(37,"Acciones"),e.qZA()()(),e.TgZ(38,"tbody"),e.YNc(39,Ie,30,17,"tr",16),e.qZA()()(),e.TgZ(40,"div",17)(41,"app-pagination",18),e.NdJ("cambioPagina",function(a){return t.onChangePage(a)}),e.qZA()(),e.TgZ(42,"app-incidenteModal",19),e.NdJ("closeModal",function(a){return t.onCloseModal(a)}),e.qZA()()),2&i&&(e.xp6(2),e.Q6J("ngForOf",t.infoIncidentesCard),e.xp6(3),e.Q6J("ngIf",t.esUsuarioNormal),e.xp6(1),e.Q6J("ngIf",!t.esUsuarioNormal&&!t.esAdmin),e.xp6(1),e.Q6J("ngIf",t.esAdmin),e.xp6(3),e.Q6J("ngIf",t.esUsuarioNormal),e.xp6(2),e.Q6J("ngIf",!t.esUsuarioNormal),e.xp6(12),e.Q6J("ngIf",!t.esUsuarioNormal),e.xp6(1),e.Q6J("ngIf",!t.esUsuarioNormal),e.xp6(1),e.Q6J("ngIf",!t.esUsuarioNormal),e.xp6(1),e.Q6J("ngIf",!t.esUsuarioNormal),e.xp6(12),e.Q6J("ngForOf",t.incidentes),e.xp6(2),e.Q6J("items",t.incidentes),e.xp6(1),e.Q6J("IncidenteInput",t.incidenteSeleccionado)("BDIncidente",t.BDIncidente)("esAdmin",t.esAdmin)("esUsuarioNormal",t.esUsuarioNormal))},dependencies:[h.sg,h.O5,E.E,M.Q,j,ee,h.rS,h.uU,ie],styles:[".btn[_ngcontent-%COMP%]{margin-right:10px;display:flex;flex-direction:row;justify-content:center;align-items:center}.fa[_ngcontent-%COMP%]{margin-right:10px}body[_ngcontent-%COMP%]{margin:0!important}.backgroundColor[_ngcontent-%COMP%]{background-color:#3086f2}"]}),n})();const ge=[{path:"",component:A,children:[{path:"listado",component:A},{path:"**",redirectTo:"listado"}]}];let _e=(()=>{class n{}return n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[T.Bz.forChild(ge),T.Bz]}),n})(),be=(()=>{class n{}return n.\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[h.ez,_e,x.m,c.UX,S.D]}),n})()}}]);